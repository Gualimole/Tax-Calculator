

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Recipe 6: Analyzing a Non-Parametric Reform &#8212; Tax-Calculator documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Recipe 5: Redefining Expanded Income" href="recipe05.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/PSL.svg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Tax-Calculator documentation</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../intro.html">Tax-Calculator documentation</a>
  </li>
  <li class="active">
    <a href="index.html">Welcome to taxcalc’s documentation!</a>
  <ul class="nav sidenav_l2">
    <li class="">
      <a href="recipe00.html">Basic Recipe: Static Analysis of a Simple Reform</a>
    </li>
    <li class="">
      <a href="recipe01.html">Recipe 1: Directly Comparing Two Reforms</a>
    </li>
    <li class="">
      <a href="recipe02.html">Recipe 2: Estimating Behavioral Response to Reform</a>
    </li>
    <li class="">
      <a href="recipe03.html">Recipe 3: Creating a Custom Table</a>
    </li>
    <li class="">
      <a href="recipe04.html">Recipe 4: Estimating Differential Reform Response</a>
    </li>
    <li class="">
      <a href="recipe04_pandas.html">Recipe 4: Estimating Differential Reform Response - pandas version</a>
    </li>
    <li class="">
      <a href="recipe05.html">Recipe 5: Redefining Expanded Income</a>
    </li>
    <li class="active">
      <a href="">Recipe 6: Analyzing a Non-Parametric Reform</a>
    </li>
  </ul>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
                    class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="../_sources/examples/recipe06.md"><button type="button"
                        class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                        data-placement="left">.md</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                    onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Source interaction buttons -->
        

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="recipe-6-analyzing-a-non-parametric-reform">
<h1>Recipe 6: Analyzing a Non-Parametric Reform<a class="headerlink" href="#recipe-6-analyzing-a-non-parametric-reform" title="Permalink to this headline">¶</a></h1>
<p>This is an advanced recipe that should be followed only after mastering the basic recipe.
This recipe shows how to customize the Calculator class so that it can analyze a tax reform
that cannot be characterized using existing policy parameters (in this case a pseudo Cost-of-Living Refund reform).
It uses, in a more extensive way, the object-oriented programming inheritance technique introduced in Redefining Expanded Income,
so you might want to read that recipe first.</p>
<p>Recipe that illustrates how to customize the taxcalc Calculator class so that
it can analyze a non-parametric reform (that is, a reform that cannot be
represented using existing taxcalc Policy parameters.</p>
<p>The technique for doing this customization is standard in object-oriented
programming: a child class is derived from a parent class and then customized.
The derived child class inherits all the data and methods of the parent class,
but can be customized by adding new data and methods or by overriding inherited
methods.</p>
<p>The reform used to illustrate this programming technique is somewhat like
the Cost-of-Living Refund, a refundable credit that was being discussed in
tax policy circles during 2019 as a replacement for the EITC.  But the
reform analyzed here is not exactly like the Cost-of-Living Refund, so we
call it a pseudo cost-of-living refund to emphasize that it is not meant
to be an accurate representation of the Cost-of-Living Refund proposal.</p>
<p>.. code-block:: python3</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import numpy as np
import taxcalc as tc


class Calculator(tc.Calculator):
&quot;&quot;&quot;
Customized Calculator class that inherits all tc.Calculator data and
methods, adding or overriding some to get the desired customization.
&quot;&quot;&quot;
def __init__(self, policy=None, records=None, verbose=False,
	     sync_years=True, consumption=None,
	     # above are the tc.Calculator constructor arguments
	     # below is new constructor argument used in customization
	     colr_active=False):
    # call the parent class constructor
    super().__init__(policy=policy, records=records,
		     verbose=verbose, sync_years=sync_years,
		     consumption=consumption)
    # remember whether pseudo_COLR policy is active or not
    self.colr_active = colr_active
    # declare colr_param dictionary that will contain pseudo COLR policy
    self.colr_param = dict()

def specify_pseudo_colr_policy(self):
    &quot;&quot;&quot;
    Specify policy parameters for the COLR policy in the current_year.
    See use of these parameters below in the pseudo_colr_amount method.
    &quot;&quot;&quot;
    # reform implementation year
    reform_year = 2020
    # specify dictionary of parameter names and values for reform_year
    self.colr_param = {
	# credit phase-in rate on earnings
	&#39;COLR_rt&#39;: 1.0,
	# ceiling on refundable credit varies by filing-unit type, MARS
	&#39;COLR_c&#39;: np.array([4000, 8000, 4000, 4000, 4000],
			   dtype=np.float64),
	# credit phase-out start AGI level varies by filing-unit type, MARS
	&#39;COLR_ps&#39;: np.array([30000, 50000, 30000, 30000, 30000],
			    dtype=np.float64),
	# credit phase-out rate per dollar of AGI above COLR_ps level
	&#39;COLR_prt&#39;: 0.2
    }
    # set pseudo COLR parameter values for current year
    this_year = self.current_year
    if self.colr_active and this_year &gt;= reform_year:
	# set inflation-indexed values of COLR_c and COLR_ps for this year
	irates = self.__policy.inflation_rates()
	syr = tc.Policy.JSON_START_YEAR
	for name in [&#39;COLR_c&#39;, &#39;COLR_ps&#39;]:
	    value = self.colr_param[name]
	    for year in range(reform_year, this_year):
		value *= (1.0 + irates[year - syr])
	    self.colr_param[name] = np.round(value, 2)  # to nearest penny
    else:  # if policy not active or if this year is before the reform year
	# set ceiling to zero
	self.colr_param[&#39;COLR_c&#39;] = np.array([0.0, 0.0, 0.0, 0.0, 0.0],
					     dtype=np.float64)
    tracing = False  # set to True to see parameter values for this year
    if tracing:
	for name in self.colr_param:
	    print(&#39;&gt; {} {} {}&#39;.format(
		this_year, name, self.colr_param[name]
	    ))

def pseudo_colr_amount(self):
    &quot;&quot;&quot;
    Calculate pseudo Cost-of-Living Refund amount.
    Note this is simply meant to illustrate a Python programming technique;
    this function does NOT calculate an exact Cost-of-Living Refund amount.
    See setting of parameters above in specify_pseudo_COLR_policy method.
    &quot;&quot;&quot;
    recs = self.__records
    # create MARS-specific policy parameter arrays
    mars_indicators = [recs.MARS == 1, recs.MARS == 2, recs.MARS == 3,
		       recs.MARS == 4, recs.MARS == 5]
    colr_c = np.select(mars_indicators, self.colr_param[&#39;COLR_c&#39;])
    colr_ps = np.select(mars_indicators, self.colr_param[&#39;COLR_ps&#39;])
    colr_rt = self.colr_param[&#39;COLR_rt&#39;]
    colr_prt = self.colr_param[&#39;COLR_prt&#39;]
    # compute colr_amt
    amt_pre_phaseout = np.minimum(recs.e00200 * colr_rt, colr_c)
    phaseout = np.maximum((recs.c00100 - colr_ps) * colr_prt, 0.)
    colr_amt = np.maximum(amt_pre_phaseout - phaseout, 0.)
    setattr(recs, &#39;colr_amount&#39;, colr_amt)
    # reduce income and combined taxes because COLR is a refundable credit
    recs.iitax -= colr_amt
    recs.combined -= colr_amt
    # delete local arrays used only in this method
    del mars_indicators
    del colr_c
    del colr_ps
    del amt_pre_phaseout
    del phaseout
    del colr_amt

def calc_all(self, zero_out_calc_vars=False):
    &quot;&quot;&quot;
    Call all tax-calculation functions for the current_year.
    &quot;&quot;&quot;
    tc.BenefitPrograms(self)
    self._calc_one_year(zero_out_calc_vars)
    tc.BenefitSurtax(self)
    tc.BenefitLimitation(self)
    tc.FairShareTax(self.__policy, self.__records)
    tc.LumpSumTax(self.__policy, self.__records)
    # specify new method to set pseudo COLR policy parameters
    self.specify_pseudo_colr_policy()  # (see above)
    # call new method to calculate pseudo COLR amount
    self.pseudo_colr_amount()  # (see above)
    tc.ExpandIncome(self.__policy, self.__records)
    tc.AfterTaxIncome(self.__policy, self.__records)

# end of customized Calculator class definition


# top-level logic of program that uses customized Calculator class

policy1 = tc.Policy()  # baseline policy is current-law policy
policy2 = tc.Policy()  # parametric reform, reformC.json, eliminates EITC

# TODO: Move to the web so this can be done standalone.
policy2.implement_reform(tc.Policy.read_json_reform(&#39;_static/reformC.json&#39;))

# specify customized Calculator objects for baseline and reform:
#   baseline calc1 uses policy1 (current-law) and colr_active=False
#   reform calc2 uses policy2 (no EITC) and colr_active=True
cps_records = tc.Records.cps_constructor()
calc1 = Calculator(policy=policy1, records=cps_records, colr_active=False)
calc2 = Calculator(policy=policy2, records=cps_records, colr_active=True)

# calculate tax liabilities for years around the reform year
CYR_FIRST = 2019
CYR_LAST = 2022
for cyr in range(CYR_FIRST, CYR_LAST + 1):
# advance to and calculate for specified cyr
calc1.advance_to_year(cyr)
calc1.calc_all()
calc2.advance_to_year(cyr)
calc2.calc_all()
# tabulate weighted amounts
funits = calc1.total_weight()
itax1 = calc1.weighted_total(&#39;iitax&#39;)
itax2 = calc2.weighted_total(&#39;iitax&#39;)
eitc1 = calc1.weighted_total(&#39;eitc&#39;)
eitc2 = calc2.weighted_total(&#39;eitc&#39;)
colr1 = calc1.weighted_total(&#39;colr_amount&#39;)
colr2 = calc2.weighted_total(&#39;colr_amount&#39;)
# print weighted amounts for cyr
if cyr == CYR_FIRST:
    print(&#39;YEAR  UNITS   ITAX1   ITAX2  EITC1  EITC2  COLR1  COLR2&#39;)
line = &#39;{}  {:.1f}  {:.1f}  {:.1f}  {:5.1f}  {:5.1f}  {:5.1f}  {:5.1f}&#39;
print(line.format(cyr, funits * 1e-6,
		  itax1 * 1e-9, itax2 * 1e-9,
		  eitc1 * 1e-9, eitc2 * 1e-9,
		  colr1 * 1e-9, colr2 * 1e-9))
</pre></div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="recipe05.html" title="previous page">Recipe 5: Redefining Expanded Income</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Policy Simulation Library<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>